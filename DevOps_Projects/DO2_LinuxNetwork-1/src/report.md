## Part 1. Инструмент ipcalc
1. Сети и маски  
 - ![1.1.1](./images/1.1.1.png "Адрес сети 192.167.38.54/13")  
 - ![1.1.2](./images/1.1.2.png "Перевод маски 255.255.255.0 в префиксную и двоичную запись")  
 - ![1.1.3](./images/1.1.3.png "/15 в обычную и двоичную")  
 - ![1.1.4](./images/1.1.4.png "11111111.11111111.11111111.11110000 в обычную и префиксную")
 - ![1.1.5](./images/1.1.5.png "Минимальный и максимальный хост в сети 12.167.38.4 при маскe: /8")  
 - ![1.1.6](./images/1.1.6.png "Минимальный и максимальный хост в сети 12.167.38.4 при маскe: 11111111.11111111.00000000.00000000") 
 - ![1.1.7](./images/1.1.7.png "Минимальный и максимальный хост в сети 12.167.38.4 при маскe: 255.255.254.0")  
 - ![1.1.8](./images/1.1.8.png "Минимальный и максимальный хост в сети 12.167.38.4 при маскe: /4")
2. localhost
  - ![1.2.1](./images/1.2.1.png)  
  - IP: 194.34.23.100 и IP: 128.0.0.1 не смогут обратиться к приложению, работающему на localhost;   
  - IP: 127.0.0.2 и IP: 127.1.0.1 смогут обратиться к приложению, работающему на localhost;  
  3. Диапазоны и сегменты сетей    
  - ![1.3.1](./images/1.3.1.png)
  Частные IP адреса: 10.0.0.45, 10.10.10.10, 172.20.250.4, 172.16.255.255, 192.168.4.2;  
  Публичные IP адреса: 134.43.0.2, 172.0.2.1, 172.68.0.2, 192.172.0.1, 192.169.168.1;  
  - ![1.3.2](./images/1.3.2.png "IP адрес 10.10.0.0/18")  
  Возможен: 10.10.0.2, 10.10.10.10, 10.10.1.255;  
  Не возможен: 10.0.0.1, 10.10.100.1;
## Part 2. Статическая маршрутизация между двумя машинами
 - ![2.0.1](./images/2.0.1.png "Поднять две виртуальные машины (далее -- ws1 и ws2)")  
  По умолчанию у ws1 и ws2 одинаковые настройки сети, так как гипервизор VirtualBox создает виртуальные сети и интерфейсы для виртуальных машин, а затем настраивает их на общую конфигурацию по умолчанию;  
  Также для подключения двух виртуальных машин друг к другу был подключен тип интерфейса Внутренняя сеть - enp08s;     
  - ![2.0.2](./images/2.0.2.png "Команда netplan apply для перезапуска сервиса сети")    
  - ![2.0.3](./images/2.0.3.png "Изменённые файлы etc/netplan/00-installer-config.yaml для каждой машины")  
1. Добавление статического маршрута вручную
  - ![2.1.1](./images/2.1.1.png "Добавлен статический маршрут от ws1 до ws2 и обратно при помощи команды вида ip r add, и пропинговал соединение между машинами")
2. Добавление статического маршрута с сохранением  
  - ![2.2.1](./images/2.2.1.png "Добавлен статический маршрут от ws1 до ws2 и обратно с помощью файла etc/netplan/00-installer-config.yaml")
## Part 3. Утилита iperf3
1. Скорость соединения
  -  8 Mbps = 1 MB/s;   
  - 100 MB/s = 80000 Kbps;   
  - 1 Gbps = 1000 Mbps;  
2. Утилита iperf3
  - ![3.2.1](./images/3.2.1.png "Измерение скорости соединения между ws1 и ws2")
## Part 4. Сетевой экран
1. Утилита iptables  
  - ![4.1.1](./images/4.1.1.png "Скрин с запуском обоих файлов")  
  на машине ws1 мы применили стратегию сначало правило запрещающее пинг и после правило разрешающее пинг, на машине ws2 мы применили стратегию сначало правило разрешающее пинг и после правило запрещающее пинг;
2. Утилита nmap
  - ![4.2.1](./images/4.2.1.png "вывод использованных команд ping и nmap")  
  - ![4.2.2](./images/4.2.2.png "дамп образa ws1")  
  - ![4.2.3](./images/4.2.3.png "дамп образa ws2")
## Part 5. Статическая маршрутизация сети
1. Настройка адресов машин
  - ![5.1.1](./images/5.1.1.png "скрины с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.1.2](./images/5.1.2.png "скрины с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.1.3](./images/5.1.3.png "скрины с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.1.4](./images/5.1.4.png "Перезапустить сервис сети. Если ошибок нет, то командой ip -4 a, пинг ws22 с ws21")
  - ![5.1.5](./images/5.1.5.png "Перезапустить сервис сети. Если ошибок нет, то командой ip -4 a, пинг r1 с ws11.")
  - ![5.1.6](./images/5.1.6.png "Перезапустить сервис сети. Если ошибок нет, то командой ip -4 a")
2. Включение переадресации IP-адресов
  - ![5.2.1](./images/5.2.1.png "вывод использованной команды sysctl -w net.ipv4.ip_forward=1")
  - ![5.2.2](./images/5.2.2.png "изменённый файл /etc/sysctl.conf.")
3. Установка маршрута по-умолчанию
  - ![5.3.1](./images/5.3.1.png "Добавлен gateway, скрин с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.3.2](./images/5.3.2.png "Добавлен gateway, скрин с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.3.3](./images/5.3.3.png "Добавлен gateway, скрин с содержанием файла etc/netplan/00-installer-config.yaml")
  - ![5.3.4](./images/5.3.4.png "Пинг с ws11 роутер r2 и показать на r2, что пинг доходит")
4. Добавление статических маршрутов
  - ![5.4.1](./images/5.4.1.png "Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций")
  - ![5.4.2](./images/5.4.2.png "Запуск команд на ws11")  
  - Для адреса 10.10.0.0/[маска сети] был выбран маршрут, отличный от 0.0.0.0/0, потому как он указывает на все адреса, на скрине привел ввод справки ipcalc;  
5. Построение списка маршрутизаторов
  - ![5.5.1](./images/5.5.1.png "При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21")  
  При команде traceroute пакеты проходит на своем пути определенное количество узлов, пока не достигнет своей цели которую мы указали при вызове команды;
6.  Использование протокола ICMP при маршрутизации
  ![5.6.1](./images/5.6.1.png "Пинг с ws11 несуществующий IP (например, 10.30.0.111)")
## Part 6. Динамическая настройка IP с помощью DHCP
  Для настройки службы DHCP на Ubuntu, установил пакет DHCP сервера: sudo apt-get install isc-dhcp-server;  
  - ![6.1.1](./images/6.1.1.png "r2 файл /etc/dhcp/dhcpd.conf конфигурацию службы DHCP")
  - ![6.1.2](./images/6.1.2.png "r2 файл resolv.conf прописать nameserver 8.8.8.8")
  - ![6.1.3](./images/6.1.3.png "Перезагрузка службы DHCP командой systemctl restart isc-dhcp-server")
  - ![6.1.4](./images/6.1.4.png "пинг ws22 с ws21")
  - ![6.1.5](./images/6.1.5.png "настройки на ws1 и r1")  
  Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11);  
  Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true;  
  - ![6.1.6](./images/6.1.6.png "настройкa на r1")
  - ![6.1.7](./images/6.1.7.png)  
  Перезагрузка службы DHCP командой systemctl restart isc-dhcp-server. Машину ws11 перезагрузить при помощи reboot и через ip a показать, что она получила адрес. Также пропинговать ws22 с ws11;  
  - ![6.1.8](./images/6.1.8.png "before")
  - ![6.1.9](./images/6.1.9.png "after")  
  command: sudo dhclient -r enp0s8 - Флаг -r явно освобождает текущую аренду, IP-адреса для конкретного интерфейса;  
  command: sudo dhclient enp0s8 - запрос на получение IP-адреса для конкретного интерфейса;
## Part 7. NAT
  - ![7.0.1](./images/7.0.1.png "В файле /etc/apache2/ports.conf на ws22 и r1 изменить строку Listen 80 на Listen 0.0.0.0:80")  
  Запуск веб-сервера Apache2 командой service apache2 start на ws22 и r1;
  - ![7.0.2](./images/7.0.2.png "скрины с вызовом и выводом использованных команд")
  Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:  
  1 удаление правил в таблице filter - iptables -F;  
  2 удаление правил в таблице "NAT" - iptables -F -t nat;  
  3 отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP;  
  При запуске файла с этими правилами, ws22 не должна "пинговаться" с r1;  
  - ![7.0.3](./images/7.0.3.png)  
  Pазрешить маршрутизацию всех пакетов протокола ICMP;  
  - ![7.0.4](./images/7.0.4.png)  
  Проверка соединение по TCP для SNAT, для этого с ws22 подключились к серверу Apache на r1;  
  - ![7.0.5](./images/7.0.5.png)  
  Проверка соединение по TCP для DNAT, для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080);
## Part 8. Дополнительно. Знакомство с SSH Tunnels
  - ![8.0.1](./images/8.0.1.png "Запустить на r2 фаервол с правилами из Части 7")
1. Local TCP forwarding
  - На виртуальные машины ws21 и ws22 установил openssh-server командой: sudo apt install openssh-server -y;  
  - ![8.1.1](./images/8.1.1.png)  
  Включаем перенаправление портов "AllowTcpForwarding yes" в конфигурационном файле sshd_config и перезагружаем ssh;  
  - ![8.1.2](./images/8.1.2.png)  
  Подключаемся к веб-серверу apache2 через Local TCP forwarding с ws21 на ws22;  
  - ![8.1.3](./images/8.1.3.png "подключились")    
  - ![8.1.4](./images/8.1.4.png)  
  Для проверки, сработало ли подключение, перешли во второй терминал (клавишами Alt + F2) и выполните команду: telnet 127.0.0.1 8080;
2. Remote TCP forwarding
  - На виртуальную машину ws11 установил openssh-server командой: sudo apt install openssh-server -y;
  - ![8.2.1](./images/8.2.1.png)  
  Включаем перенаправление портов "AllowTcpForwarding yes" в конфигурационном файле sshd_config и перезагружаем ssh;  
  - ![8.2.2](./images/8.2.2.png)  
  Подключаемся к веб-серверу apache2 через Remote TCP forwarding устанавив ssh-соединение в обратном направлении — от ws22 к ws1;